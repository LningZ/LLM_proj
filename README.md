ä»¥ä¸‹å†…å®¹å¯ç›´æ¥å­˜æˆ **`README.md`** æˆ–è€…ç²˜åˆ°æŠ¥å‘Šç¬”è®°ä¸­ã€‚å·²æŒ‰ *ç›®å½•->æ–‡ä»¶->å‡½æ•°->é€»è¾‘* å±‚çº§å®Œæ•´æ¢³ç†ï¼Œå¹¶åˆ—å‡ºä¸‹ä¸€é˜¶æ®µå¼€å‘è®¡åˆ’ï¼Œä¾¿äºåŒå­¦å¿«é€Ÿç†è§£å¹¶ç»§ç»­è¿­ä»£ã€‚
ï¼ˆæ‰€æœ‰è·¯å¾„å‡ä»¥ `ML_pro/` ä¸ºæ ¹ï¼‰

---

## ğŸ“‚ é¡¹ç›®ç»“æ„ä¸€è§ˆ

| è·¯å¾„                       | è¯´æ˜                                              |
| ------------------------ | ----------------------------------------------- |
| `cnc_llm.ipynb`          | ä¸» Notebookï¼šUIã€ä¸šåŠ¡æµç¨‹ã€ç»“æœå¯è§†åŒ–                        |
| `llm_utils.py`           | ä¸ OpenAI API äº¤äº’ã€è‡ªåŠ¨é‡è¯•ã€token ç»Ÿè®¡                   |
| `requirements.txt`       | é¡¹ç›®ä¾èµ–ï¼ˆ`openaiâ€†Â·â€†tenacityâ€†Â·â€†pandasâ€†Â·â€†ipywidgets`ï¼‰ |
| `.env`                   | ç§å¯†ç¯å¢ƒå˜é‡ï¼Œä»…å­˜ `OPENAI_API_KEY=...`                  |
| `LLMs_projet_note.ipynb` | æ—©æœŸå®éªŒè‰ç¨¿ï¼ˆå¯å¿½ç•¥æˆ–å­˜æ¡£ï¼‰                                  |

---

## 1ï¸âƒ£ `llm_utils.py` â€”â€” LLM è°ƒç”¨æ ¸å¿ƒ

```python
load_dotenv()                        # è¯»å– .env
client = openai.OpenAI(api_key=...)  # åˆå§‹åŒ–å®‰å…¨å®¢æˆ·ç«¯
TOKENS_USED: int = 0                 # å…¨å±€ token è®¡æ•°
```

### chat\_completion(prompt,â€¦, verbose=True)

> **åŠŸèƒ½**ï¼š
>
> 1. å›ºå®š system promptï¼Œç¡®ä¿è¾“å‡ºä¸º *JSON array*ã€‚
> 2. `tenacity` è‡ªåŠ¨é‡è¯•ï¼Œæœ€å¤§ 3 æ¬¡ã€æŒ‡æ•°é€€é¿ 1â€“10 sã€‚
> 3. æˆåŠŸåç´¯åŠ  `response.usage.total_tokens` åˆ° `TOKENS_USED`ã€‚
> 4. `verbose` å¼€å…³ï¼šè°ƒè¯•æœŸæ‰“å°åŸå§‹ JSONï¼Œç”Ÿäº§æœŸé™é»˜ã€‚

---

## 2ï¸âƒ£ `cnc_llm.ipynb` â€”â€” ä¸»æµç¨‹æ‹†è§£

| æ­¥éª¤           | å¯¹åº”å•å…ƒå‡½æ•°                                                                | å…³é”®é€»è¾‘                                                                                  |
| ------------ | --------------------------------------------------------------------- | ------------------------------------------------------------------------------------- |
| **UI å®šä¹‰**    | `desc_inputâ€†/â€†material_selectorâ€†/â€†generate_buttonâ€†/â€†output_area`      | çº¯ `ipywidgets`ï¼Œæœ€åä¸€æ¬¡æ€§ `display(...)`                                                   |
| **æŒ‰é’®å›è°ƒ**     | `on_generate_clicked(b)`                                              | æ•´ä¸ªä¸šåŠ¡ç®¡çº¿                                                                                |
| â‘  è·å– outline | `get_outline(part, material)`<br>â†’ `chat_completion(verbose=False)`   | ç”Ÿæˆé«˜é˜¶å·¥åºåˆ—è¡¨ï¼Œå¦‚ â€œRough Machiningâ€                                                          |
| â‘¡ è·å– detail  | `get_detail(outline, â€¦)`                                              | ä¼ å…¥ outlineï¼Œè¯·æ±‚å¸¦ rpm/feed çš„ JSON                                                        |
| â‘¢ è§£æ         | `parse_llm_output(raw_json)`                                          | `json.loads` â†’ DataFrame åˆ—é‡å‘½å                                                         |
| â‘£ ä¸¤è§†å›¾å±•ç¤º      | *åŒä¸€å•å…ƒå†…*<br>`df_full_valid`ï¼ˆå®Œæ•´æµç¨‹ï¼‰<br>`df_cut_valid`ï¼ˆè¿‡æ»¤ rpm>0 & feed>0ï¼‰ | <br>â€¢ ç”¨ `validate_plan` æ·»åˆ— `RPM Valid / Feed Valid`<br>â€¢ `display_plan_table()` é«˜äº®éæ³•å€¼ |
| â‘¤ åæ€æ‘˜è¦       | `reflect_summary(raw_json, df_full_valid)`                            | æ­¥æ•°ã€éæ³•è®¡æ•°ã€Tokenã€äººå·¥æç¤º                                                                    |

> **validate\_plan(df, material)**
> è¯»å–å†…ç½®åŒºé—´ï¼ˆé“/é’¢ï¼‰ï¼Œç”¨ `between()` åˆ¤æ–­åˆæ³•ã€‚

> **highlight\_invalid(val)**
> è¿”å›çº¢åº• CSSã€‚pandasâ‰¥2.2 ä½¿ç”¨ `df.style.map` é¿å…æœªæ¥åºŸå¼ƒè­¦å‘Šã€‚

---

## 3ï¸âƒ£ å·²å®ç°çš„å°ç»†èŠ‚

| ç»†èŠ‚                        | ä¸ºä»€ä¹ˆè¦è¿™æ ·                      |
| ------------------------- | --------------------------- |
| `.env + load_dotenv()`    | ä¸æ³„æ¼ API Keyï¼Œç¬¦åˆè¯¾ç¨‹â€œå®‰å…¨ & è´¹ç”¨â€è¦æ±‚ |
| `TOKENS_USED` ç»Ÿè®¡          | ä¾¿äºå†™åœ¨æŠ¥å‘Šé‡Œè¯„ä¼°æˆæœ¬                 |
| åŒè§†å›¾ï¼šFull & Machining-only | è®©é˜…å·è€å¸ˆæ—¢çœ‹å…¨æµç¨‹ï¼Œåˆèƒ½ä¸“æ³¨åˆ‡å‰Šå‚æ•°         |
| `verbose` å¼€å…³              | Demo æ—¶ç•Œé¢å¹²å‡€ï¼Œè°ƒè¯•æ—¶å¯è¿½ JSON       |

---

## 4ï¸âƒ£ ä¸‹ä¸€é˜¶æ®µè·¯çº¿å›¾ï¼ˆå¯¹åº”åŸè“å›¾ Phase 2-3ï¼‰

| é˜¶æ®µ                                | ç›®æ ‡                                                                               | å…³é”®ä¿®æ”¹ç‚¹                                                    |
| --------------------------------- | -------------------------------------------------------------------------------- | -------------------------------------------------------- |
| **Phase 2**<br>é“¾å¼ Prompt & å¤šææ–™    | - å°† `get_outline` + `get_detail` æ˜ç¡®åˆ†æˆä¸¤è½® promptï¼ˆå·²å…·é›å½¢ï¼‰<br>- åœ¨ UI åŠ åˆ€å…·/ææ–™ä¸‹æ‹‰æ¡†æ‰©å±•æ›´å¤šææ–™   | `get_detail` prompt ä¸­æ³¨å…¥ææ–™åŒºé—´ï¼Œè®© LLM è‡ªåŠ¨è°ƒ rpm/feed           |
| **Phase 3**<br>å¤–éƒ¨åŒ–ææ–™-å‚æ•°æ•°æ®åº“        | - æŠŠ `LIMITS` å†™å…¥ `materials.json`<br>- `validate_plan` åŠ¨æ€è¯»å–                       | æ–°å»º `materials.json` å¹¶è°ƒæ•´ `validation.py`ï¼ˆå¾…åˆ›å»ºï¼‰             |
| **Phase 4**<br>åŠŸç‡/æ‰­çŸ©æ ¡éªŒ + CSV å¯¼å‡º   | - `add_power_check(df)` ä¼°ç®—åŠŸç‡å¹¶éªŒè¯<br>- `widgets.Button("ğŸ’¾ Export")` è¾“å‡º `plan.csv` | Notebook UI å†åŠ ä¸€ä¸ªå¯¼å‡ºæŒ‰é’®                                     |
| **Phase 5**<br>Few-shot vector å¬å› | é€‰ 5 æ¡äººå·¥ä¼˜è´¨å·¥è‰º â†’ `sentence_transformers` å»ºç´¢å¼•ï¼Œè¿‘é‚»æ‹¼è¿› prompt                            | å¦å»º `examples/` ç›®å½•ï¼Œå†™ `retriever.py`                       |
| **Phase 6**<br>è‡ªåŠ¨çº é”™å¾ªç¯             | è‹¥ `RPM Valid`=False â†’ è‡ªåŠ¨å›å†™æç¤ºå¹¶äºŒæ¬¡è°ƒç”¨ LLM ä¿®æ­£                                         | åœ¨ `on_generate_clicked` é‡Œåš while-loop with max 2 retries |

> å¯ä»¥æŒ‰æ—¶é—´/ç²¾åŠ›åªå®ç° 2â€Šâ€“â€Š3â€Šâ€“â€Š4 å°±èƒ½æ‹¿é«˜åˆ†ï¼›5â€Šâ€“â€Š6 ä½œä¸ºåŠ åˆ†é¡¹ã€‚

---

## 5ï¸âƒ£ å¯¹åŒå­¦çš„ä½¿ç”¨æŒ‡å¼•

1. **å®‰è£…ä¾èµ–**

   ```bash
   pip install -r requirements.txt
   ```
2. **é…ç½® Key**
   åœ¨é¡¹ç›®æ ¹å»º `.env` âœï¸

   ```env
   OPENAI_API_KEY=sk-xxxx
   ```
3. **è¿è¡Œ Notebook**
   `cnc_llm.ipynb` â†’ *Run All*
4. **è¾“å…¥é›¶ä»¶æè¿° & é€‰ææ–™** â†’ ç‚¹å‡» **Generate CNC Plan**
5. **æŸ¥çœ‹ä¸¤å¼ è¡¨**

   * *Full Process Plan*ï¼šå«é€‰æ–™/æ£€éªŒ
   * *Machining-only Plan*ï¼šä»…åˆ‡å‰Šæ­¥éª¤
6. **é˜…è¯» Reflection Summary** â†’ äº†è§£éæ³•å‚æ•°ä¸ token æˆæœ¬
7. **ä¸‹ä¸€æ­¥**ï¼šæŒ‰ README çš„â€œé˜¶æ®µè·¯çº¿å›¾â€å®ç° Phase 2 â€¦

---
